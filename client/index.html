<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Counter Battle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            font-size: 3em;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .login-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-container {
            display: none;
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .counter-display {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            margin: 20px 0;
        }

        .progress-container {
            width: 100%;
            height: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            background-size: 200% 100%;
            animation: progressGlow 2s linear infinite;
            border-radius: 20px;
            transition: width 0.5s ease;
        }

        @keyframes progressGlow {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
        }

        .increment-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
            display: block;
            position: relative;
            overflow: hidden;
        }

        .increment-button.heating {
            background: linear-gradient(45deg, #ff4757, #ff6348, #ffa502);
            box-shadow: 0 0 30px rgba(255, 100, 100, 0.6), 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: pulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .heat-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, 
                rgba(255, 0, 0, 0.8) 0%,
                rgba(255, 100, 0, 0.6) 50%,
                rgba(255, 200, 0, 0.4) 100%);
            border-radius: 50%;
            transition: height 0.3s ease;
            pointer-events: none;
        }

        .increment-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .increment-button:hover::before {
            left: 100%;
        }

        .increment-button:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .increment-button:active {
            transform: scale(0.95);
        }

        .increment-button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
            transform: scale(0.9);
        }

        /* Compact Leaderboard Styles */
        .leaderboard {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: 280px;
            display: flex;
            flex-direction: column;
        }

        .leaderboard h3 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .leaderboard-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
        }

        .leaderboard-container::-webkit-scrollbar {
            width: 6px;
        }

        .leaderboard-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .leaderboard-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .leaderboard-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .leaderboard-list {
            list-style: none;
            padding-right: 5px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            margin: 3px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 0.9em;
            min-height: 32px;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(3px);
        }

        .leaderboard-item.top {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            font-weight: bold;
            transform: scale(1.02);
        }

        .leaderboard-item.second {
            background: linear-gradient(45deg, #c0c0c0, #e8e8e8);
            color: #333;
        }

        .leaderboard-item.third {
            background: linear-gradient(45deg, #cd7f32, #daa520);
            color: white;
        }

        .leaderboard-item.current-player {
            border: 2px solid #4ecdc4 !important;
            background: rgba(78, 205, 196, 0.2) !important;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.4) !important;
        }

        .rank {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 8px;
            font-size: 0.8em;
            flex-shrink: 0;
        }

        .player-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
        }

        .player-score {
            font-weight: bold;
            flex-shrink: 0;
        }

        .taunt-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 100, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 1000;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .taunt-display.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1);
        }

        .power-ups {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .power-up {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 0.9em;
        }

        .power-up:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .power-up:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .join-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .join-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #4ecdc4;
            border-radius: 50%;
            pointer-events: none;
        }

        .achievements {
            margin-top: 20px;
        }

        .achievement {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid #ffd700;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            opacity: 0;
            transform: translateX(-100px);
            transition: all 0.5s ease;
        }

        .achievement.unlocked {
            opacity: 1;
            transform: translateX(0);
        }

        .multiplier-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 100, 100, 0.9);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .multiplier-display.show {
            opacity: 1;
        }

        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .leaderboard {
                height: 250px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .counter-display {
                font-size: 2.5em;
            }
            
            .increment-button {
                width: 150px;
                height: 150px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .leaderboard {
                height: 200px;
            }

            .leaderboard-item {
                font-size: 0.8em;
                padding: 5px 8px;
                min-height: 28px;
            }

            .rank {
                width: 20px;
                height: 20px;
                font-size: 0.7em;
            }
        }
    </style>
</head>
<body>
    <!-- Animated background -->
    <div class="stars" id="stars"></div>
    <div class="particles" id="particles"></div>

    <div class="container">
        <h1>🚀 Epic Counter Battle 🚀</h1>

        <!-- Login Screen -->
        <div id="login" class="login-container">
            <h2>Join the Battle!</h2>
            <div class="input-group">
                <input type="text" id="username" placeholder="Enter your battle name" maxlength="15">
                <button id="joinBtn" class="join-btn">🎮 Enter Arena</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game" class="game-container">
            <div class="stats-grid">
                <!-- Counter Stats -->
                <div class="stat-card">
                    <h3>🏆 Global Counter</h3>
                    <div class="counter-display" id="total">0</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                        <div class="progress-text" id="progressText">0 / 10000</div>
                    </div>
                </div>

                <!-- Player Stats -->
                <div class="stat-card">
                    <h3>⚡ Your Stats</h3>
                    <div>
                        <p>Score: <span id="playerScore">0</span></p>
                        <p>Rank: <span id="playerRank">#-</span></p>
                        <p>CPS: <span id="clicksPerSecond">0.0</span></p>
                        <p>Streak: <span id="streak">0</span></p>
                    </div>
                </div>

                <!-- Compact Leaderboard -->
                <div class="stat-card leaderboard">
                    <h3>🏅 Top Players</h3>
                    <div class="leaderboard-container">
                        <ul id="leaderboard" class="leaderboard-list"></ul>
                    </div>
                </div>
            </div>

            <!-- Power-ups -->
            <div class="power-ups">
                <button class="power-up" id="doubleClick" title="Double clicks for 10 seconds">⚡ Double (500pts)</button>
                <button class="power-up" id="rapidFire" title="Remove cooldown for 5 seconds">🔥 Rapid (750pts)</button>
                <button class="power-up" id="shield" title="Protect from taunts">🛡️ Shield (300pts)</button>
            </div>

            <!-- Main Action Button -->
            <button id="incrementBtn" class="increment-button">
                <div class="heat-overlay" id="heatOverlay"></div>
                <span id="buttonText">CLICK!</span>
            </button>

            <!-- Achievements -->
            <div class="achievements">
                <h3>🎖️ Achievements</h3>
                <div id="achievementsList"></div>
            </div>
        </div>
    </div>

    <!-- Floating Elements -->
    <div id="taunt" class="taunt-display"></div>
    <div id="multiplierDisplay" class="multiplier-display">2x MULTIPLIER!</div>
    <div id="rateLimit" style="display: none;"></div>

    <script>
        // WebSocket connection
        const ws = new WebSocket('ws://real-time-multi-client-engine.onrender.com:8080');

        // Game state
        let playerId = null;
        let canClick = true;
        let playerData = { score: 0, rank: 0 };
        let clickTimes = [];
        let streak = 0;
        let lastClickTime = 0;
        let achievements = new Set();
        let powerUps = {
            doubleClick: { active: false, endTime: 0 },
            rapidFire: { active: false, endTime: 0 },
            shield: { active: false, endTime: 0 }
        };

        // Demo hack - special username for unlimited clicking
        let isDemoMode = false;

        // Heat system
        let heatLevel = 0;          // 0 to 100
        let lastHeatTime = 0;
        const HEAT_INCREMENT = 15;  // per click
        const HEAT_DECAY = 1;       // per decay interval
        const HEAT_DECAY_DELAY = 800; // ms before decay starts

        // Sound effects
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Create sound effects
        function playSound(frequency, duration, type = 'sine', volume = 0.1) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        function playClickSound() {
            // Different sounds based on heat level
            if (heatLevel > 80) {
                playSound(800 + Math.random() * 200, 0.1, 'square', 0.15); // Hot click
            } else if (heatLevel > 50) {
                playSound(600 + Math.random() * 100, 0.1, 'triangle', 0.12); // Warm click
            } else {
                playSound(400 + Math.random() * 50, 0.1, 'sine', 0.1); // Normal click
            }
        }

        function playPowerUpSound() {
            // Ascending notes for power-up
            setTimeout(() => playSound(400, 0.1, 'sine', 0.2), 0);
            setTimeout(() => playSound(500, 0.1, 'sine', 0.2), 50);
            setTimeout(() => playSound(600, 0.1, 'sine', 0.2), 100);
        }

        function playAchievementSound() {
            // Achievement fanfare
            setTimeout(() => playSound(600, 0.2, 'sine', 0.15), 0);
            setTimeout(() => playSound(800, 0.2, 'sine', 0.15), 100);
            setTimeout(() => playSound(1000, 0.3, 'sine', 0.15), 200);
        }

        // DOM elements
        const loginDiv = document.getElementById('login');
        const gameDiv = document.getElementById('game');
        const usernameInput = document.getElementById('username');
        const joinBtn = document.getElementById('joinBtn');
        const totalCounterEl = document.getElementById('total');
        const incrementBtn = document.getElementById('incrementBtn');
        const leaderboardEl = document.getElementById('leaderboard');
        const tauntEl = document.getElementById('taunt');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const playerScoreEl = document.getElementById('playerScore');
        const playerRankEl = document.getElementById('playerRank');
        const cpsEl = document.getElementById('clicksPerSecond');
        const streakEl = document.getElementById('streak');
        const multiplierDisplay = document.getElementById('multiplierDisplay');
        const buttonText = document.getElementById('buttonText');
        const heatOverlay = document.getElementById('heatOverlay');

        // Heat system functions
        function updateButtonHeat() {
            heatOverlay.style.height = heatLevel + '%';
            
            // Change button appearance based on heat
            if (heatLevel > 80) {
                incrementBtn.classList.add('heating');
            } else {
                incrementBtn.classList.remove('heating');
            }
        }

        // Scroll leaderboard to show current player
        function scrollToPlayer() {
            const leaderboardContainer = document.querySelector('.leaderboard-container');
            const playerElement = leaderboardContainer.querySelector('.current-player');
            
            if (playerElement && leaderboardContainer) {
                const containerHeight = leaderboardContainer.clientHeight;
                const elementTop = playerElement.offsetTop;
                const elementHeight = playerElement.clientHeight;
                
                // Calculate scroll position to center the player
                const scrollTo = elementTop - (containerHeight / 2) + (elementHeight / 2);
                
                leaderboardContainer.scrollTo({
                    top: scrollTo,
                    behavior: 'smooth'
                });
            }
        }

        // Heat decay system
        setInterval(() => {
            const now = Date.now();
            if (heatLevel > 0 && now - lastHeatTime > HEAT_DECAY_DELAY) {
                heatLevel = Math.max(0, heatLevel - HEAT_DECAY);
                updateButtonHeat();
            }
        }, 50);

        // Initialize background effects
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        function createParticleExplosion(x, y) {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                const angle = (Math.PI * 2 * i) / 15;
                const velocity = 50 + Math.random() * 100;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                particlesContainer.appendChild(particle);
                
                let px = x, py = y;
                const animate = () => {
                    px += vx * 0.016;
                    py += vy * 0.016 + 0.5; // gravity
                    particle.style.left = px + 'px';
                    particle.style.top = py + 'px';
                    particle.style.opacity = parseFloat(particle.style.opacity || 1) - 0.02;
                    
                    if (parseFloat(particle.style.opacity) > 0 && py < window.innerHeight) {
                        requestAnimationFrame(animate);
                    } else {
                        particlesContainer.removeChild(particle);
                    }
                };
                requestAnimationFrame(animate);
            }
        }

        // Calculate clicks per second
        function updateCPS() {
            const now = Date.now();
            clickTimes = clickTimes.filter(time => now - time < 1000);
            const cps = clickTimes.length;
            cpsEl.textContent = cps.toFixed(1);
        }

        // Update streak
        function updateStreak() {
            const now = Date.now();
            if (now - lastClickTime < 2000) {
                streak++;
            } else {
                streak = 1;
            }
            streakEl.textContent = streak;
            lastClickTime = now;
        }

        // Check achievements
        function checkAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            const newAchievements = [];

            if (playerData.score >= 100 && !achievements.has('century')) {
                achievements.add('century');
                newAchievements.push('🎯 Century Club - Reached 100 points!');
            }
            if (playerData.score >= 1000 && !achievements.has('thousand')) {
                achievements.add('thousand');
                newAchievements.push('🚀 Space Cadet - Reached 1000 points!');
            }
            if (streak >= 50 && !achievements.has('streaker')) {
                achievements.add('streaker');
                newAchievements.push('🔥 On Fire - 50 click streak!');
            }
            if (heatLevel >= 100 && !achievements.has('overheated')) {
                achievements.add('overheated');
                newAchievements.push('🌡️ Overheated - Maxed out the heat meter!');
            }

            newAchievements.forEach(text => {
                const achievement = document.createElement('div');
                achievement.className = 'achievement';
                achievement.textContent = text;
                achievementsList.appendChild(achievement);
                setTimeout(() => {
                    achievement.classList.add('unlocked');
                    playAchievementSound();
                }, 100);
            });
        }

        // Animate counter
        function animateCounter(el, newValue) {
            const current = parseInt(el.textContent);
            if (current === newValue) return;
            
            const duration = 500;
            const start = Date.now();
            const startValue = current;
            
            const animate = () => {
                const elapsed = Date.now() - start;
                const progress = Math.min(elapsed / duration, 1);
                const value = Math.floor(startValue + (newValue - startValue) * progress);
                el.textContent = value.toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            };
            animate();
        }

        // Show taunt
        function showTaunt(message) {
            if (powerUps.shield.active) return; // Shield blocks taunts
            
            tauntEl.textContent = message;
            tauntEl.classList.add('show');
            setTimeout(() => tauntEl.classList.remove('show'), 3000);
        }

        // Power-up handlers
        document.getElementById('doubleClick').addEventListener('click', () => {
            if (playerData.score >= 500 && !powerUps.doubleClick.active) {
                powerUps.doubleClick.active = true;
                powerUps.doubleClick.endTime = Date.now() + 10000;
                ws.send(JSON.stringify({ type: 'buyPowerUp', powerUp: 'doubleClick' }));
                playPowerUpSound();
            }
        });

        document.getElementById('rapidFire').addEventListener('click', () => {
            if (playerData.score >= 750 && !powerUps.rapidFire.active) {
                powerUps.rapidFire.active = true;
                powerUps.rapidFire.endTime = Date.now() + 5000;
                ws.send(JSON.stringify({ type: 'buyPowerUp', powerUp: 'rapidFire' }));
                playPowerUpSound();
            }
        });

        document.getElementById('shield').addEventListener('click', () => {
            if (playerData.score >= 300 && !powerUps.shield.active) {
                powerUps.shield.active = true;
                powerUps.shield.endTime = Date.now() + 30000;
                ws.send(JSON.stringify({ type: 'buyPowerUp', powerUp: 'shield' }));
                playPowerUpSound();
            }
        });

        // Update power-ups
        function updatePowerUps() {
            const now = Date.now();
            
            Object.keys(powerUps).forEach(key => {
                const powerUp = powerUps[key];
                if (powerUp.active && now > powerUp.endTime) {
                    powerUp.active = false;
                }
                
                const button = document.getElementById(key);
                button.disabled = powerUp.active || 
                    (key === 'doubleClick' && playerData.score < 500) ||
                    (key === 'rapidFire' && playerData.score < 750) ||
                    (key === 'shield' && playerData.score < 300);
            });

            // Update button text based on active power-ups
            if (powerUps.doubleClick.active) {
                buttonText.textContent = '2X POWER!';
                multiplierDisplay.classList.add('show');
            } else if (powerUps.rapidFire.active) {
                buttonText.textContent = 'RAPID FIRE!';
            } else {
                buttonText.textContent = 'CLICK!';
                multiplierDisplay.classList.remove('show');
            }
        }

        // WebSocket message handling
        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);

                switch (data.type) {
                    case 'assignId':
                        playerId = data.playerId;
                        break;

                    case 'totalCounter':
                        animateCounter(totalCounterEl, data.total);
                        const progress = Math.min(100, (data.total / 10000) * 100);
                        progressBar.style.width = progress + '%';
                        progressText.textContent = `${data.total.toLocaleString()} / 10,000`;
                        break;

                    case 'leaderboard':
                        leaderboardEl.innerHTML = '';
                        data.leaderboard.forEach((player, idx) => {
                            const li = document.createElement('li');
                            li.className = 'leaderboard-item';
                            
                            if (idx === 0) li.classList.add('top');
                            else if (idx === 1) li.classList.add('second');
                            else if (idx === 2) li.classList.add('third');

                            // Highlight current player
                            if (player.username === usernameInput.value) {
                                li.classList.add('current-player');
                            }

                            li.innerHTML = `
                                <div style="display: flex; align-items: center; min-width: 0;">
                                    <div class="rank">${idx + 1}</div>
                                    <span class="player-name">${player.username}${player.username === usernameInput.value ? ' (You)' : ''}</span>
                                </div>
                                <span class="player-score">${player.score.toLocaleString()}</span>
                            `;
                            leaderboardEl.appendChild(li);

                            // Update player data if this is current player
                            if (player.username === usernameInput.value) {
                                playerData.score = player.score;
                                playerData.rank = idx + 1;
                                playerScoreEl.textContent = player.score.toLocaleString();
                                playerRankEl.textContent = `#${idx + 1}`;
                                checkAchievements();
                            }
                        });
                        
                        // Auto-scroll to show current player position
                        setTimeout(scrollToPlayer, 100);
                        break;

                    case 'taunt':
                        showTaunt(data.message);
                        break;

                    case 'rateLimited':
                        // Handle rate limiting with visual feedback
                        incrementBtn.style.background = 'linear-gradient(45deg, #ff4757, #ff3838)';
                        setTimeout(() => {
                            incrementBtn.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4)';
                        }, 1000);
                        break;
                }
            } catch (err) {
                console.error('Error parsing message:', err);
            }
        };

        // Join game
        joinBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            if (!username) return alert('Please enter a battle name!');

            // Check for demo mode
            if (username === '91150saurabh') {
                isDemoMode = true;
                console.log('🚀 DEMO MODE ACTIVATED - Unlimited clicking enabled!');
                
                // Visual indication of demo mode
                document.body.style.border = '5px solid #ff6b6b';
                const demoIndicator = document.createElement('div');
                demoIndicator.innerHTML = '🚀 DEMO MODE ACTIVE';
                demoIndicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    left: 10px;
                    background: rgba(255, 0, 0, 0.9);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 25px;
                    font-weight: bold;
                    z-index: 9999;
                    animation: pulse 1s infinite;
                `;
                document.body.appendChild(demoIndicator);
            }

            ws.send(JSON.stringify({ type: 'register', username }));
            loginDiv.style.display = 'none';
            gameDiv.style.display = 'block';
        });

        // Main click handler
        incrementBtn.addEventListener('click', (e) => {
            // Demo mode bypasses all restrictions
            if (!isDemoMode) {
                if (!canClick && !powerUps.rapidFire.active) return;
            }

            // Play click sound
            playClickSound();

            // Update heat system
            lastHeatTime = Date.now();
            heatLevel = Math.min(100, heatLevel + HEAT_INCREMENT);
            updateButtonHeat();

            // Create particle explosion at click position
            const rect = incrementBtn.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            createParticleExplosion(x, y);

            // Send increment
            ws.send(JSON.stringify({ 
                type: 'increment',
                demoMode: isDemoMode 
            }));

            // Update UI
            clickTimes.push(Date.now());
            updateCPS();
            updateStreak();

            // Cooldown (unless rapid fire is active or demo mode)
            if (!powerUps.rapidFire.active && !isDemoMode) {
                canClick = false;
                incrementBtn.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    canClick = true;
                    incrementBtn.style.transform = 'scale(1)';
                }, 500);
            }
        });

        // Update game state periodically
        setInterval(() => {
            updateCPS();
            updatePowerUps();
            
            // Check for heat-based achievements
            if (heatLevel >= 100) {
                checkAchievements();
            }
        }, 100);

        // Initialize
        createStars();
        
        // Enter key to join
        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') joinBtn.click();
        });

        // Spacebar to click
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && gameDiv.style.display !== 'none') {
                e.preventDefault();
                incrementBtn.click();
            }
        });
    </script>
</body>
</html>




<!-- Programming Languages : C | C++ | Python | SQL | Java.
Software Tools : Visual Studio | Google Colab | Git/Github | Notion | LaTeX.
Frameworks/Modules : Numpy | Pandas | Matplotlib | Scikit-Learn | nltk | BeautifulSoup.
Techniques/Concepts : Socket Programming | Multithreading | Object Oriented Programming | SDLC. -->